{% comment %} 

  {% for link in linklists.main-menu.links %} 
    {% assign child_list_handle = link.title | handleize %} 
      {% if linklists[child_list_handle].links != blank %}
        <a href="{{ link.url }}">{{ link.title }}</a>
        [{% for childlink in linklists[child_list_handle].links %}
            <a href="{{ childlink.url }}">{{ childlink.title | escape }}</a>
        {% endfor %}] {% else %}
        <a href="{{ link.url }}">{{ link.title }}</a>
      {% endif %} 
  {% endfor %} 
  
{% if shop.customer_accounts_enabled %} 
  {% if customer %}
    <a href="/account">account</a>
    {{ "log out" | customer_logout_link }}
  {% else %}
    {{ "log in " | customer_login_link }}
    {{ "register" | customer_register_link }}
  {% endif %} 
{% endif %} 

{% endcomment %}


<header class="z-10 fixed inset-0 py-5 mx-10 border-b border-gray-500 bg-white select-none" style="height: min-content" id="header">
    <nav class="flex justify-between items-center">
        <div id="menu-modal">
            {% unless template == 'product' %}
              <button>
                  <span>Menu</span>
              </button>
            {% else %}
              <a href="javascript:history.back()">Back</a>
            {% endunless %}
        </div>
    
        <a href="/">{{ shop.name }}</a>

        <button class="w-8 h-8 relative transition-all" title="shopping cart" id="cart-button" @click="toggleCart">
          <svg xmlns="http://www.w3.org/2000/svg"   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-shopping-cart w-8 h-8 cart-icon"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
          <span class="text-xs font-medium absolute top-2 left-4 text-gray-700">${cartCount || ""}</span>
        </button>
    </nav>

    <transition name="cart">
      <section id="cart-modal" v-show="isCartVisible" class="absolute top-20 right-0 w-96 z-20 bg-white border border-gray-700 px-6 py-3 shadow-2xl" style="height: 88.5vh;">
        <h1 class=" text-md font-semibold my-2">Cart</h1>
        {% render 'cart-modal' %}
      </section>
    </transition>
    <div class="w-full h-full fixed top-0 left-0 z-0" v-show="isCartVisible || isMenuVisible" @click="closeAllMenu" style="z-index: -10;"></div>
</header>

<script>
  if (document.querySelector('#header')) {
    const header = Vue.createApp({
      delimiters: ["${", "}"],
      data() {
        return {

        }
      },
      created() {
        store.getCart();
      },
      computed: {
        cart() {
          return store.state.cart.items;
        },
        cartCount() {
          return this.cart.item_count;
        },
        isCartVisible() {
          return !store.state.cart.hidden;
        },
        isMenuVisible() {
          return !store.state.menu.hidden;
        }
      },
      methods: {
        toggleCart() {
          store.toggleCart();
        },
        async incItem(item) {
          const data = {
            "id": item.key,
            quantity: item.quantity + 1
          }

          try {
            await fetch('/cart/change.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });
  
            store.getCart();
          } catch (err) {
            console.log(err);
          }
        },
        async decItem(item) {
          const data = {
            "id": item.key,
            quantity: item.quantity > 1 ? item.quantity - 1 : 0
          }

          try {
            await fetch('/cart/change.js', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });
  
            store.getCart();
          } catch (err) {
            console.log(err);
          }
        },
        toPrice(price) {
          return "$" + (price / 100).toFixed(2);
        },
        closeAllMenu() {
          store.closeAll();
        }
      }
    }).mount('#header');
  }
</script>

<style scoped>
  .cart-icon {
    stroke: rgba(55, 65, 81, .9);
  }

  #cart-button::after {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-46%, -56%) scale(0);
    opacity: 0;
  }

  #cart-button:hover::after {
    content: "";
    height: 3.25rem;
    width: 3.25rem;
    border-radius: 50%;
    display: inline-block;
    animation: cart-icon-hover .2s forwards;
  }

  @keyframes cart-icon-hover {
    100% {
      background-color: rgba(55, 65, 81, .1);
      box-shadow: inset 0 0 8px rgba(55, 65, 81, .25);
      transform: translate(-46%, -56%) scale(1);
      opacity: 1;
    }
  }

  .quantity-selector {
    line-height: 0.875rem; 
    padding-top: 0.125rem;
  }

  
  .quantity-btn::after {
    position: absolute;
    top: -2px;
    left: -55%;
    transform: scale(0);
    opacity: 0;
  }

  .quantity-selector:last-child::after {
    left: -40.5%;
  }

  .quantity-btn:hover::after {
    content: "";
    height: 20px;
    width: 20px;
    border-radius: 50%;
    display: inline-block;
    animation: quantity-icon-hover .2s forwards;
  }

  @keyframes quantity-icon-hover {
    100% {
      background-color: rgba(55, 65, 81, .1);
      box-shadow: inset 0 0 8px rgba(55, 65, 81, .25);
      transform: scale(1);
      opacity: 1;
    }
  }

  .cart-enter-active {
    animation: cart-modal-animate 0.3s ease-in forwards;
  }

  .cart-leave-active {
    animation: cart-modal-animate 0.3s ease-out reverse;
  }

  @keyframes cart-modal-animate {
    from {
      right: -384px;
    }
    to {
      right: 0;
    }
  }

</style>